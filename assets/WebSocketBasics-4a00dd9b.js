import{r as l,S as v,j as s,a as c}from"./index-30a93734.js";import{W as f}from"./WSClient-c3269280.js";function x(){const[r,p]=l.useState(v),[n,m]=l.useState("idle"),[d,g]=l.useState([]),[o,b]=l.useState("hello"),[h,N]=l.useState(()=>({lastAliveAt:0})),u=l.useRef(null),i=l.useMemo(()=>{const e=new f({url:r,heartbeatIntervalMs:5e3,heartbeatTimeoutMs:8e3});return e.onStatus=t=>m(t),e.onOpen=()=>a("open"),e.onClose=t=>a(`close code=${t==null?void 0:t.code} reason=${t==null?void 0:t.reason}`),e.onError=()=>a("error"),e.onMessage=t=>{const S=Date.now();N({lastAliveAt:S}),a(typeof t=="string"?`recv(text): ${t}`:`recv(json): ${JSON.stringify(t)}`)},e},[r]),a=e=>g(t=>[`[${new Date().toLocaleTimeString()}] ${e}`,...t.slice(0,199)]);return l.useEffect(()=>(u.current=i,()=>{var e;return(e=u.current)==null?void 0:e.disconnect()}),[i]),s("div",{className:"page",children:c("div",{className:"grid two",children:[c("div",{className:"card",children:[s("div",{className:"card-title",children:"WebSocket 基础"}),c("div",{className:"card-body",children:[c("div",{className:"row gap",children:[s("input",{className:"input",value:r,onChange:e=>p(e.target.value),placeholder:"ws://localhost:3000/ws","aria-label":"服务器地址"}),s("button",{className:"btn",onClick:()=>i.connect().catch(e=>a(String(e))),disabled:n==="open"||n==="connecting",children:"连接"}),s("button",{className:"btn",onClick:()=>i.disconnect(),disabled:n!=="open",children:"断开"})]}),c("div",{className:"row gap",children:[c("span",{className:`chip ${n==="open"?"good":n==="error"?"bad":"info"}`,"aria-live":"polite",children:[s("span",{className:"dot"}),"状态: ",n]}),c("span",{className:"chip",children:["心跳: ",h.lastAliveAt?new Date(h.lastAliveAt).toLocaleTimeString():"--"]})]}),c("div",{className:"row gap",children:[s("input",{className:"input",value:o,onChange:e=>b(e.target.value),"aria-label":"发送文本"}),s("button",{className:"btn",onClick:()=>{try{i.send(o),a(`send(text): ${o}`)}catch(e){a(String(e))}},disabled:n!=="open",children:"发送文本"}),s("button",{className:"btn",onClick:()=>{const e={type:"echo",payload:{text:o}};try{i.send(e),a(`send(json): ${JSON.stringify(e)}`)}catch(t){a(String(t))}},disabled:n!=="open",children:"发送 JSON"}),s("button",{className:"btn",onClick:()=>{try{i.send({type:"ping"}),a("send ping")}catch(e){a(String(e))}},disabled:n!=="open",children:"发送 Ping"})]})]})]}),c("div",{className:"card",children:[s("div",{className:"card-title",children:"消息日志"}),s("div",{className:"card-body",children:s("div",{style:{maxHeight:320,overflow:"auto",fontFamily:"ui-monospace, Menlo, monospace",fontSize:13},children:d.length===0?s("div",{className:"muted",children:"暂无日志"}):d.map((e,t)=>s("div",{children:e},t))})})]})]})})}export{x as default};
