import{r as n,S as b,j as a,a as s}from"./index-2f2e5893.js";import{W as S}from"./WSClient-4a6f9690.js";function I(){const[l,p]=n.useState("chat-room"),[i,v]=n.useState(()=>`u-${Math.floor(Math.random()*999)}`),[N,f]=n.useState("idle"),[r,d]=n.useState("Hello"),[u,h]=n.useState([]),m=n.useRef(null),o=n.useMemo(()=>{const e=new S({url:b,heartbeatIntervalMs:8e3,heartbeatTimeoutMs:12e3});return e.onStatus=c=>f(c),e.onMessage=c=>{const t=typeof c=="string"?null:c;if((t==null?void 0:t.type)==="chat"&&(t==null?void 0:t.roomId)===l){const g=t.payload;h(y=>[g,...y].slice(0,200))}t==null||t.type},e},[l]);return n.useEffect(()=>(m.current=o,()=>{var e;return(e=m.current)==null?void 0:e.disconnect()}),[o]),a("div",{className:"page",children:s("div",{className:"grid two",children:[s("div",{className:"card",children:[a("div",{className:"card-title",children:"群组聊天室"}),s("div",{className:"card-body",children:[s("div",{className:"row gap",children:[a("input",{className:"input",value:l,onChange:e=>p(e.target.value),"aria-label":"房间ID"}),a("input",{className:"input",value:i,onChange:e=>v(e.target.value),"aria-label":"昵称"}),a("button",{className:"btn",onClick:async()=>{await o.connect(),o.send({type:"join",roomId:l})},children:"加入"}),s("span",{className:"chip",children:[a("span",{className:"dot"}),N]})]}),s("div",{className:"row gap",children:[a("input",{className:"input",value:r,onChange:e=>d(e.target.value),"aria-label":"消息"}),a("button",{className:"btn",onClick:()=>{const e={id:`${Date.now()}`,text:r,from:i,at:Date.now()};try{o.send({type:"chat",roomId:l,payload:e})}catch{}h(c=>[e,...c].slice(0,200)),d("")},children:"发送"})]})]})]}),s("div",{className:"card",children:[a("div",{className:"card-title",children:"消息"}),a("div",{className:"card-body",children:a("div",{style:{maxHeight:320,overflow:"auto"},children:u.length===0?a("div",{className:"muted",children:"暂无消息"}):u.map(e=>s("div",{children:[s("span",{className:"muted",children:["[",new Date(e.at).toLocaleTimeString(),"]"]})," ",a("b",{children:e.from||"me"}),": ",e.text]},e.id))})})]})]})})}export{I as default};
