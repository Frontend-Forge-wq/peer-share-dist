import{r,j as t,a as c}from"./index-2f2e5893.js";import{T as b}from"./TutorialPeer-9374b14b.js";import"./WSClient-4a6f9690.js";function x(){const[d,m]=r.useState("demo"),[h,p]=r.useState("idle"),[o,f]=r.useState("hi"),[v,i]=r.useState(!1),s=r.useRef(null),l=r.useRef(null),a=r.useRef(null);return r.useEffect(()=>()=>{a.current&&(a.current.hangup(),a.current=null,i(!1))},[]),t("div",{className:"page",children:c("div",{className:"grid two",children:[c("div",{className:"card",children:[t("div",{className:"card-title",children:"WebRTC 基础"}),c("div",{className:"card-body",children:[c("div",{className:"row gap",children:[t("input",{className:"input",value:d,onChange:e=>m(e.target.value),"aria-label":"房间ID"}),t("button",{className:"btn",onClick:async()=>{if(v&&a.current){console.log("[WebRTCBasics] 已经连接，忽略重复连接请求");return}a.current&&(a.current.hangup(),a.current=null);const e=new b({roomId:d});e.onStatus=n=>{p(`${n.pcState}/${n.dcState}/${n.wsOpen?"ws":"no-ws"}`),i(n.wsOpen&&n.pcState!=="closed")},e.onRemoteStream=n=>{l.current&&(l.current.srcObject=n)},await e.connect();const u=await e.startLocalMedia({audio:!0,video:!0});s.current&&(s.current.srcObject=u,s.current.muted=!0),a.current=e,i(!0)},children:"连接"}),t("button",{className:"btn",onClick:async()=>{var e;await((e=a.current)==null?void 0:e.call())},children:"发起呼叫"}),t("button",{className:"btn",onClick:()=>{a.current&&(a.current.hangup(),a.current=null),s.current&&(s.current.srcObject=null),l.current&&(l.current.srcObject=null),i(!1)},children:"挂断"}),c("span",{className:"chip",children:[t("span",{className:"dot"}),h]})]}),c("div",{className:"row gap",children:[t("input",{className:"input",value:o,onChange:e=>f(e.target.value),"aria-label":"文本"}),t("button",{className:"btn",onClick:()=>{var e,u;try{(e=a.current)==null||e.ensureDataChannel(),(u=a.current)==null||u.sendText(o)}catch{}},children:"发送文本"})]})]})]}),c("div",{className:"card",children:[t("div",{className:"card-title",children:"媒体预览"}),t("div",{className:"card-body",children:c("div",{className:"grid two",children:[c("div",{children:[t("div",{className:"muted",children:"本地"}),t("video",{ref:s,playsInline:!0,autoPlay:!0,style:{width:"100%",borderRadius:8}})]}),c("div",{children:[t("div",{className:"muted",children:"远端"}),t("video",{ref:l,playsInline:!0,autoPlay:!0,style:{width:"100%",borderRadius:8}})]})]})})]})]})})}export{x as default};
